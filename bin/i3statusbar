#!/bin/bash
while :
do
  # Battery status
  adapter=`acpi -V | grep "Adapter 0:" | cut -c 12-`
  battery=`acpi -V | grep -m 1 "Battery 0:" | sed -r "s/.*, ([0-9]?[0-9][0-9]%)/\1/"`
  if [ "$adapter" = "on-line" ]
  then
    battery="\uf1bc $battery"
  else
    battery="\uf0cd $battery"
  fi

  # Volume
  volume=`amixer get 'Master' | grep Playback | grep % | sed -r "s/.*Playback [0-9]?[0-9]?[0-9] \[(.*%)\].*/\1/"`
  volume="\uf001 $volume"

  # Listening status
  statusLine=""
  playing=`~/.i3/bin/playmusic/playingnow`
  playingLabel="\uf022"
  if [ -n "$playing" ]
  then
    playingLabel="$playingLabel $playing"
  else
    playingLabel="$playingLabel Off"
  fi

  # Clock status
  now="\uf016 $(date +"%H:%M")"
  echo -e "[$volume][$playingLabel][$battery][$now]"
  sleep 30
done
